<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{fragments/layout :: layout (~{::body},'edit','Cập nhật nhân viên')}">
<head>
    <title>Edit User</title>
</head>
<body>
<h1>Edit User</h1>
<div th:if="${errorMessage}" class="error" th:text="${errorMessage}"></div>

<form th:action="@{/users/edit/{id}(id=${user.id})}" method="post" enctype="multipart/form-data">
    <div>
        <label for="tenNV">Tên nhân viên:</label>
        <input type="text" id="tenNV" name="tenNV" th:value="${user.tenNV}" required />
    </div>
    <div>
        <label for="username">Username:</label>
        <input type="text" id="username" name="username" th:value="${user.username}" readonly class="disabled-input" />
    </div>
    <div>
        <label for="password">Password:</label>
        <input type="password" id="password" name="password" />
    </div>
    <div>
        <label for="sdt">Số điện thoại:</label>
        <input type="text" id="sdt" name="sdt" th:value="${user.sdt}" />
    </div>
    <div>
        <label for="diaChi">Địa chỉ:</label>
        <input type="text" id="diaChi" name="diaChi" th:value="${user.diaChi}" />
    </div>
    <div>
       <span>ảnh cũ</span>
        <img th:if="${user.avatarPath != null}"
             th:src="@{'/user/img/' + ${user.avatarPath}}"
             alt="Avatar"
             style="width: 100px; height: 100px;" />
        <br>

        <span>ảnh mới</span>
        <label for="avatar">Avatar:</label>
        <input type="file" id="avatar" name="avatar" accept="image/*" onchange="previewImage(this);" />
        <img id="avatarPreview" src="#" alt="Avatar Preview" style="display: none; max-width: 200px; max-height: 200px;"/>
        <div th:if="${avatarError}" class="error" th:text="${avatarError}"></div>
        <br/>
    </div>
    <div>
        <label for="ngayBatDauLam">Ngày bắt đầu làm:</label>
        <input type="date" id="ngayBatDauLam" name="ngayBatDauLam" th:value="${#dates.format(user.ngayBatDauLam, 'yyyy-MM-dd')}" />
    </div>
    <div>
        <label for="gioiTinh">Giới tính:</label>
        <select id="gioiTinh" name="gioiTinh">
            <option value="0" th:selected="${user.gioiTinh == 0}">Nam</option>
            <option value="1" th:selected="${user.gioiTinh == 1}">Nữ</option>
            <option value="2" th:selected="${user.gioiTinh == 2}">Khác</option>
        </select>
    </div>
    <div>
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" th:value="${user.email}" readonly class="disabled-input" />
    </div>
    <div>
        <label for="chucvuId">Chức vụ:</label>
        <select id="chucvuId" name="chucvuId">
            <option th:each="chucvu : ${chucVus}"
                    th:value="${chucvu.id}"
                    th:text="${chucvu.tenChucVu}"
                    th:selected="${chucvu.id == user.chucvu.id}">
            </option>
        </select>
    </div>
    <div>
        <label for="vpchinhId">Văn phòng chính:</label>
        <select id="vpchinhId" name="vpchinhId">
            <option th:each="vanPhong : ${vanPhongs}"
                    th:value="${vanPhong.id}"
                    th:text="${vanPhong.tenVP}"
                    th:selected="${vanPhong.id == user.vpLamViecChinh.id}">
            </option>
        </select>
    </div>
    <div>
        <label for="roles">Roles:</label>
        <select id="roles" name="roles">
            <option th:each="role : ${roles}" th:value="${role.id}" th:text="${role.name}"
                    th:selected="${userRoles.contains(role)}"></option>
        </select>
        <div th:if="${roleError}" class="error" th:text="${roleError}"></div>
    </div>
    <div>
        <button type="submit">Save</button>
    </div>
</form>
<script>
    function previewImage(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function(e) {
                $('#avatarPreview').attr('src', e.target.result);
                $('#avatarPreview').show();
            }

            reader.readAsDataURL(input.files[0]);
        }
    }
</script>
</body>
</html>