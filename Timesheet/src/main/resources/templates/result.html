<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{fragments/layout :: layout (~{::body},'home','Home')}"
>

<body>
<section class="content-header">
    <div class="col-xs-12">
        <div class="box">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h1><a th:href="@{/}" th:text="${pageTitle}">.</a></h1>
                    </div>
                </div>
            </div><!-- /.container-fluid -->
            <hr>
            <!-- Main content -->
            <section class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="sticky-top mb-3">
                                    <div class="card-header">
                                        <h4 class="card-title text-center"><strong>APPOINTMENT</strong></h4>
                                    </div>
                                <div class="card-body">
                                    <form th:action="@{/lichlamviec/search}" th:object="${searchFilter}" method="post">
                                        <div class="form-group row">
                                            <label for="fromDate" class="col-sm-3 col-form-label">From Date:</label>
                                            <div class="col-sm-9">
                                                <input type="date" class="form-control" id="fromDate" th:field="*{tuNgay}" required>
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label for="toDate" class="col-sm-3 col-form-label">To Date:</label>
                                            <div class="col-sm-9">
                                                <input type="date" class="form-control" id="toDate" th:field="*{denNgay}" required>
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label for="office" class="col-sm-3 col-form-label">Office</label>
                                            <div class="col-sm-9">
                                                <select class="form-control" id="office" th:field="*{vpCongTac_id}">
                                                    <option th:value="NULL">All</option>
                                                    <option th:each="vanphong : ${vanPhongList}" th:value="${vanphong.id}" th:text="${vanphong.tenVP}">
                                                    </option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label for="workStatus" class="col-sm-3 col-form-label">Work Status</label>
                                            <div class="col-sm-9">
                                                <select class="form-control" id="workStatus" th:field="*{trangThaiLamViec_Id}">
                                                    <option th:value="NULL">All</option>
                                                    <option th:each="trangthai : ${trangThaiList}" th:value="${trangthai.id}" th:text="${trangthai.tenTrangThai}">
                                                    </option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <label for="staffName" class="col-sm-3 col-form-label">Staff's Name</label>
                                            <div class="col-sm-9">
                                                <input type="text" class="form-control" id="staffName" th:field="*{tenNV}" />
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <div class="col-sm-9 offset-sm-3">
                                                <button type="submit" class="btn btn-primary">Search</button>
                                                <button type="button" class="btn btn-secondary" id="clear-button">Clear</button>
                                            </div>
                                        </div>
                                    </form>
                                    <a href="/" type="button" class="btn btn-primary">Back</a>
                                </div>
                                <!-- /.card -->
                                <!--                                <div class="card">-->
                                <!--                                    <div class="card-header">-->
                                <!--                                        <h3 class="card-title">Lịch công việc</h3>-->
                                <!--                                    </div>-->
                                <!--                                    <div class="card-body">-->
                                <!--                                        <div class="todoTable-block">-->
                                <!--                                            <div class="itemsPerPage">-->
                                <!--                                                <span>items per page</span>-->
                                <!--                                                <select id="itemsPerPageSelectElem">-->
                                <!--                                                    <option>5</option>-->
                                <!--                                                    <option>10</option>-->
                                <!--                                                    <option>20</option>-->
                                <!--                                                </select>-->
                                <!--                                            </div>-->

                                <!--                                            <table id="todoTable">-->
                                <!--                                                <tr>-->
                                <!--                                                    <td></td>-->
                                <!--                                                    <td>Date</td>-->
                                <!--                                                    <td>Time</td>-->
                                <!--                                                    <td>to-do</td>-->
                                <!--                                                    <td>-->
                                <!--                                                        <select id="categoryFilter">-->
                                <!--                                                        </select>-->
                                <!--                                                    </td>-->
                                <!--                                                    <td></td>-->
                                <!--                                                </tr>-->
                                <!--                                            </table>-->

                                <!--                                            <div class="pagination-pages">-->

                                <!--                                            </div>-->
                                <!--                                        </div>-->
                                <!--                                    </div>-->
                                <!--                                </div>-->
                            </div>
                        </div>
                        <!-- /.col -->
                        <div class="col-md-9">
                            <div class="card card-primary">
                                <div class="card-body p-0">
                                    <!-- THE CALENDAR -->
                                    <div id="calendar"></div>
                                    <!-- Modal -->
                                    <div id="calendarModal" class="modal fade">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                    <h4 class="modal-title">Event Details</h4>

                                                </div>
                                                <div id="modalBody" class="modal-body">
                                                    <form th:action="@{/lichlamviec/save}" th:object="${lichlam}" method="post" id="updateForm">
                                                        <div class="form-group">
                                                            <label for="tenCongViec">Appointment Name</label>
                                                            <input type="text" class="form-control" id="tenCongViec" value="" >
                                                        </div>

                                                        <div class="form-group">
                                                            <label for="ngayLam">Working Day</label>
                                                            <input type="date" class="form-control" id="ngayLam">
                                                        </div>

                                                        <div class="form-group">
                                                            <label for="gioBatDau">Start Time</label>
                                                            <input type="time" class="form-control" id="gioBatDau" min="08:00" max="17:00">
                                                        </div>

                                                        <div class="form-group">
                                                            <label for="gioKetThuc">End Time</label>
                                                            <input type="time" class="form-control" id="gioKetThuc" min="08:00" max="17:00">
                                                        </div>

                                                        <div class="form-group">
                                                            <label for="vpCT_id">Office</label>
                                                            <select class="form-control" id="vpCT_id">
                                                                <option th:each="vanphong : ${vanPhongList}" th:value="${vanphong.id}" th:text="${vanphong.tenVP}"></option>
                                                            </select>
                                                        </div>

                                                        <div class="form-group">
                                                            <label for="trangThaiLV_Id">Work Status</label>
                                                            <select class="form-control" id="trangThaiLV_Id" >
                                                                <option th:each="trangthai : ${trangThaiList}"  th:value="${trangthai.id}"th:text="${trangthai.tenTrangThai}"></option>
                                                            </select>
                                                        </div>

                                                        <button type="submit" class="btn btn-primary">Save</button>
                                                    </form>
                                                </div>
                                                <div class="modal-footer">
                                                    <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
                                                    <button type="submit" class="btn btn-danger" id="deleteButton">Delete</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- /.card-body -->
                            </div>
                            <!-- /.card -->
                        </div>
                        <!-- /.col -->
                    </div>
                    <!-- /.row -->
                </div><!-- /.container-fluid -->
            </section>
            <!-- /.content -->
        </div>
    </div>
    <div class="todo-overlay" id="todo-overlay">
        <div class="todo-modal" id="todo-modal">
            <div class="todo-input todo-block">
                <span>To-do: </span>
                <input type="text" placeholder="Enter new to-do" id="todo-edit-todo">
                <span>Category: </span>
                <input type="text" placeholder="Enter category" list="categoryList" id="todo-edit-category">
                <datalist id="categoryList">
                    <option value="Personal"></option>
                    <option value="Work"></option>
                </datalist>
                <span>Date:</span>
                <input type="date" id="todo-edit-date">
                <span>Time:</span>
                <input type="time" id="todo-edit-time">
                <span>Link:</span>
                <input type="text" id="todo-edit-url">
                <span></span>
                <button id="changeBtn">Save Change</button>
            </div>
        </div>
        <div class="todo-modal-close-btn" id="todo-modal-close-btn">X</div>
    </div>
</section>

<script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function() {
        let listLichLam = [[${listLichLam}]];
        console.log(listLichLam);
        var listEvent =[];
        listLichLam.forEach(function(lich){
            let fullTitle=lich.tenCongViec+
                "\n" + lich.gioBatDau + "-" +lich.gioKetThuc +
                "\n" + "TenNV: " + lich.nhanVien.tenNV +
                "\n" + "HQ Name: " +  lich.nhanVien.vpLamViecChinh.diaChi+
                "\n" + "Work Place Name: " + lich.vpCongTac.diaChi+
                "\n" + "Work type: " + lich.trangThai.tenTrangThai;
            let color;
            if(lich.trangThai.id===1){
                color="#EA4215";
            }
            if(lich.trangThai.id===2){
                color="#15BDEA";
            }
            if(lich.trangThai.id===3){
                color="#AC15EA";
            }
            if(lich.trangThai.id===4){
                color="#53EA15";
            }
            var event={
                id:lich.id,
                tenCV:lich.tenCongViec.toString(),
                title:fullTitle ,
                start: lich.ngayLam + "T" + lich.gioBatDau,
                //end: endTime.concat(lich.ngayLam,"T",lich.gioKetThuc,":00:00"),
                end: lich.ngayLam + "T" + lich.gioKetThuc,
                allDay:false,
                display: 'block',
                backgroundColor:color,
                extendedProps: { // Thêm thông tin người dùng
                    nhanVienId: lich.nhanVien.id,
                    hoTen: lich.nhanVien.tenNV,
                    username: lich.nhanVien.username,
                    chucVu: lich.nhanVien.chucvu ? lich.nhanVien.chucvu.tenChucVu : "N/A" ,// Lấy tên chức vụ, kiểm tra null
                    noiCongTac: lich.vpCongTac.tenVP,
                    noiLamViec: lich.nhanVien.vpLamViecChinh ? lich.nhanVien.vpLamViecChinh.tenVP : "N/A",
                    //thêm thông tin ngày tháng
                    ngayLam:lich.ngayLam,
                    gioBatDau:lich.gioBatDau,
                    gioKetThuc:lich.gioKetThuc,
                    vpCongTacId:lich.vpCongTac.id,
                    trangThaiId:lich.trangThai.id,

                }
            };
            listEvent.push(event);
        });

        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {

            headerToolbar: { left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay,list' }, // buttons for switching between views
            allDaySlot: false,
            slotMinTime: '08:00:00',
            slotMaxTime: '18:00:00',
            firstDay: 1,
            height: 530,
            contentHeight: 200,
            eventTimeFormat: { // like '14:30:00'
                hour: 'numeric',
                minute: '2-digit',
                meridiem: false // Ẩn ký hiệu AM/PM
            },
            views: {
                dayGridMonth: { // name of view
                    titleFormat: { year: 'numeric', month: '2-digit', day: '2-digit' }
                    // other view-specific options here
                },
                timeGridDay: { // name of view
                    titleFormat: { year: 'numeric', month: '2-digit', day: '2-digit',  hour: 'numeric', minute: '2-digit', }
                    // other view-specific options here
                },
                timeGridWeek: {
                    type: 'timeGridWeek',
                    slotDuration: '24:00:00', // Đặt khoảng thời gian của mỗi slot là 24h

                    slotLabelFormat: [
                        {
                            text: '', // Không hiển thị giờ
                        },
                        { weekday: 'short' } // Chỉ hiển thị thứ
                    ]
                }
            },
            events: listEvent,
            eventClick:  function(arg) {
                console.log(arg);
                var title=arg.event._def.extendedProps.tenCV;
                var ngay=arg.event._def.extendedProps.ngayLam;
                var giobd=arg.event._def.extendedProps.gioBatDau;
                var giokt=arg.event._def.extendedProps.gioKetThuc;
                var vanPhongCTId=arg.event._def.extendedProps.vpCongTacId;
                var trangThaiId=arg.event._def.extendedProps.trangThaiId;
                console.log(vanPhongCTId);
                console.log(trangThaiId);
                // endtime = $.fullCalendar.moment(event.end).format('h:mm');
                // starttime = $.fullCalendar.moment(event.start).format('dddd, MMMM Do YYYY, h:mm');
                // var mywhen = starttime + ' - ' + endtime;
                $('#tenCongViec').val(title);
                $('#ngayLam').val(ngay);
                $('#gioBatDau').val(giobd);
                $('#gioKetThuc').val(giokt);
                $('#vpCT_id').val(vanPhongCTId.toString());
                $('#trangThaiLV_Id').val(trangThaiId.toString());
                //$('#ngayLam').val(title);
                $('#calendarModal').modal();
            },
        });
        calendar.render();
    });
</script>

<script>
    document.getElementById('clear-button').addEventListener('click', function() {
        // Get all input and select elements within the form
        const inputs = document.querySelectorAll('.card-body form input, .card-body form select');

        // Iterate through each input element and reset its value
        inputs.forEach(input => {
            if (input.type === 'date') {
                input.valueAsNumber = "dd/mm/yyyy";
            } else if (input.type === 'select-one') {
                input.selectedIndex = 0;
            } else {
                input.value = '';
            }
        });
    });
</script>

</body>

</html>